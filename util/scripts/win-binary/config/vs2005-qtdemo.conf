#
# Qt-demo consists of the compiled demos + assistant
#
# Required manual steps
# - Download dxwebsetup.exe to C:\iwmake
# - Copy vcredist_x86.exe from VS8 folder to C:\iwmake
# - Set up environment to include ActiveX
#   - set INCLUDE=C:\Program Files\Microsoft DirectX SDK (March 2008)\Include;C:\Program Files\Microsoft SDKs\Windows\v6.0\Include;%INCLUDE%
#   - set LIB=C:\Program Files\Microsoft DirectX SDK (March 2008)\Lib\x86;C:\Program Files\Microsoft SDKs\Windows\v6.0\Lib;%LIB%
# - Run EXTRACT
# - Patch demo/qtdemo/xml/examples.xml to only display startable demos
# - Copy examples/qtconcurrent/README from 4.4 depot
#

#extracts the package to buildDir
Section EXTRACT
extract     dest               "build_msvc_qtdemo_________________PADDING_________________"
extract     extUnpack          qt-win-opensource-src-%QT_VERSION%.zip
SectionEnd

#build the binaries
build       begin              vs2005    "build_msvc_qtdemo_________________PADDING_________________"

Section CONFIGURE
# sqlite is needed by assistant
build       configure          "-confirm-license -release -plugin-sql-sqlite -qt-libpng -qt-libjpeg"
SectionEnd

Section BUILD
build       bin                sub-src
build       binInDir           "tools\assistant"                release
build       binInDir           "tools\designer"                 release
build       binInDir           "demos"                          release
build       binInDir           "examples"                       release
build       finish
SectionEnd


# organize release files
Section ORGANIZE
delete      dir                "release_msvc_qtdemo"

copy        dest               "release_msvc_qtdemo"
copy        src                "build_msvc_qtdemo_________________PADDING_________________"

# copy all binary files
copy        file               "bin\qtdemo.exe"
copy        file               "bin\assistant.exe"
copy        files              "bin\*.dll" "bin"

# copy documentation files
copy        files              "doc\qch\*.qch" "doc\qch"

# copy plugins
copy        files              "plugins\accessible\*.dll" "plugins\accessible"
copy        files              "plugins\codecs\*.dll" "plugins\codecs"
copy        files              "plugins\iconengines\*.dll" "plugins\iconengines"
copy        files              "plugins\imageformats\*.dll" "plugins\imageformats"
copy        files              "plugins\sqldrivers\*.dll" "plugins\sqldrivers"
copy        files              "plugins\phonon_backend\*.dll" "plugins\phonon_backend"

# copy demo & example files
copy        files              "demos" "demos"
copy        files              "examples" "examples"

# copy external installers
copy        external            "%IWMAKE_ROOT%\dxwebsetup.exe" "prerequisites"
copy        external            "%IWMAKE_ROOT%\vcredist_x86.exe" "prerequisites"

# delete build artifacts
delete      files              "ui_*.h"
delete      files              "Makefile"
delete      files              "*.Debug"
delete      files              "*.Release"
delete      files              "*.a"
delete      files              "*.lib"
delete      files              "*.vcproj"
delete      dirs               "tmp"
delete      dirs               ".obj"
delete      dirs               ".moc"
SectionEnd

Section NSIS
# general installer options
installer   begin              "Qt"
installer   version            "demo-%QT_VERSION%"
installer   output             "%IWMAKE_ROOT%\qt-win-demo-%QT_VERSION%.exe"
installer   startmenu          "Qt Demo by Nokia v%QT_VERSION%"
installer   welcomenote        "Welcome to the Qt Demos and Examples application. This application illustrates some of the key features included the cross-platform application framework Qt. Many of these examples contain source code.\n\nFor a full, free product evaluation, please visit http://qtsoftware.com/evaluate/"
installer   welcomeicon        "images\qt-wizard-clean.bmp"

installer   enable             directory_page
installer   enable             startmenu_page

installer   instdir            msvc     0     "Qt Demo Installation Directory"

installer   runfunction        "Run Examples and Demos"
# installer   readmefunction     "Show Documentation"

# options
installer   module             msvc
installer   src                msvc     "release_msvc_qtdemo"
installer   makeFileList       msvc     "release_msvc_qtdemo"
installer   buildDir           msvc     "build_msvc_qtdemo_________________PADDING_________________"

installer   module             qtdemo
installer   define            qtdemo    vcredist   "prerequisites\vcredist_x86.exe"
installer   define            qtdemo    directx    "prerequisites\dxwebsetup.exe"

installer   licenseFile        "%IWMAKE_ROOT%\build_msvc_qtdemo_________________PADDING_________________\.LICENSE-MERGED-GPL2-GPL3"

# compile the package
installer   compile
installer   sign
SectionEnd
