#extracts the package to buildDir
extract     dest               "build_vs2008_commercial_________________PADDING_________________"
Section EXTRACT
extract     extUnpack          "qt-embedded-wince-commercial-src-%QT_VERSION%.zip"
#delete line with "activeqt" in examples.pro file (don't build this)
#delete      line               "build_vs2008_commercial_________________PADDING_________________\examples\examples.pro"  "activeqt"
SectionEnd

#build the binaries
build       begin              vs2008    "build_vs2008_commercial_________________PADDING_________________"

Section CONFIGURE
build       configure          "-confirm-license -plugin-sql-sqlite -qt-libpng -qt-libjpeg -qt-style-windowsce -qt-style-windowsmobile -no-opengl -no-qt3support -release"
SectionEnd

Section BUILD
build       bin                sub-src
build       binInDir           "tools\assistant"                release
build       binInDir           "tools\designer"                 release
build       binInDir           "tools\linguist"                 release
SectionEnd

build       finish

# organize release files
Section ORGANIZE
delete      dir                "release_vs2008_commercial"

copy        dest               "release_vs2008_commercial"
copy        src                "build_vs2008_commercial_________________PADDING_________________"

# extract everything once more
extract     dest               "release_vs2008_commercial"
extract     unpack             "qt-embedded-wince-commercial-src-%QT_VERSION%.zip"

# copy all binary files
copy        all                "*.exe"
copy        all                "*.dll"

# copy plugins to appropiate place
copy        files              "plugins\accessible\*.dll"        "bin\accessible"
copy        files              "plugins\codecs\*.dll"            "bin\codecs"
copy        files              "plugins\designer\*.dll"          "bin\designer"
copy        files              "plugins\iconengines\*.dll"       "bin\iconengines"
copy        files              "plugins\imageformats\*.dll"      "bin\imageformats"
# remove unused stuff
delete      files              "lib\*.*"
delete      destDir            "plugins"

# remove host tools being recompiled later
# unfortunately msvc.nsh depends on qmake.exe
# delete      file               "bin\qmake.exe"
delete      file               "bin\moc.exe"
delete      file               "bin\uic.exe"
delete      file               "bin\rcc.exe"
SectionEnd

Section NSIS
# general installer options
installer   begin              "Qt for Windows CE Commercial"
installer   version            "%QT_VERSION%"
installer   welcometitle       "Welcome to Qt for Windows CE"
installer   finishtitle        "Completing Qt for Windows CE"
installer   output             "c:\iwmake\qt-embedded-wince-commercial-%QT_VERSION%-vs2008.exe"
installer   startmenu          "Qt for Windows CE by Nokia v%QT_VERSION% (VS2008)"

installer   enable             component_page
installer   enable             directory_page
installer   enable             startmenu_page

installer   instdir            msvc     0     "Qt Installation Directory"

installer   readmefunction     "Show Documentation"
installer   readmestartpage    "wince-with-qt-introduction.html"

#installer   define            licensecheck    license      "LICENSE.PREVIEW.COMMERCIAL"
#installer   define            licensecheck    uslicense    "LICENSE.PREVIEW.COMMERCIAL"

# license checking
installer   module             licensecheck
installer   defineDir          licensecheck    licenseDir   "release_vs2008_commercial"
installer   define             licensecheck    productlist  "Universal|Desktop|DesktopLight|Console|FullSourceEvaluation|Academic|Educational"
installer   define             licensecheck    wince

installer   module             registeruiext

# msvc options
installer   module             msvc
installer   src                msvc     "release_vs2008_commercial"
installer   makeFileList       msvc     "release_vs2008_commercial"
installer   buildDir           msvc     "build_vs2008_commercial_________________PADDING_________________"
installer   define             msvc     vs2008ce

# compile the package
installer   compile
installer   sign
SectionEnd
